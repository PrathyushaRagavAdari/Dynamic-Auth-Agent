# sql/schema.sql
CREATE DATABASE IF NOT EXISTS GRAPHGUARD_DB;
USE DATABASE GRAPHGUARD_DB;
CREATE SCHEMA IF NOT EXISTS TRANSACTIONS;
USE SCHEMA TRANSACTIONS;

CREATE TABLE IF NOT EXISTS RAW_TRANSACTIONS (
    TRANSACTION_ID VARCHAR, USER_ID VARCHAR, CARD_ID VARCHAR, TXN_YEAR INT,
    TXN_MONTH INT, TXN_DAY INT, TXN_TIME VARCHAR, AMOUNT FLOAT,
    MERCHANT_NAME VARCHAR, MERCHANT_CITY VARCHAR, MERCHANT_STATE VARCHAR,
    MERCHANT_ZIP VARCHAR, MCC_CODE VARCHAR, IS_FRAUD BOOLEAN
);

CREATE OR REPLACE VIEW RECENT_USER_ACTIVITY AS
SELECT USER_ID, MERCHANT_NAME, MERCHANT_CITY, AMOUNT, 
       TXN_YEAR || '-' || TXN_MONTH || '-' || TXN_DAY AS TXN_DATE
FROM RAW_TRANSACTIONS WHERE IS_FRAUD = FALSE
ORDER BY TXN_YEAR DESC, TXN_MONTH DESC, TXN_DAY DESC;
